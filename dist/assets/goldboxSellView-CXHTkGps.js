import{_ as ge,r as s,l as w,i as be,c as ye,b as l,w as o,a2 as I,e as Q,j as X,a1 as W,s as xe,o as H,a3 as u,D as m,a as i,a5 as T,t as c}from"./index-DnAsP3Lt.js";import{G as Y}from"./goldbox-CBJTl11m.js";import{I as Ne}from"./inperson-_9cg4vEN.js";import{l as Z}from"./lodash-DovhEG3G.js";import{V as _}from"./VAlert-CglVYsne.js";import{V as ke,a as h,b as Ce,c as ee}from"./VTabs-C5NOnr9T.js";import{a as Pe,V as le}from"./VCard-oMxKfm86.js";import{V as n}from"./VTextField-B5JfS1qG.js";import{V as ae,a as te}from"./VDataTable-Bie8j8da.js";import{V as oe}from"./VChip-D9tPDDli.js";import"./api-DW93KxrA.js";import"./createSimpleFunctional-BImKtBcy.js";import"./index-DuVu6Xhf.js";import"./VWindowItem-Du4UUuik.js";import"./dialog-transition-BI-je_0u.js";import"./index-DH_UGFv2.js";import"./VMenu-DK2GQlZ2.js";import"./VAvatar-B69ZtACF.js";import"./VImg-BY7xTcpQ.js";import"./VDivider-SfsPokLJ.js";import"./VSelect-DW4GK2ou.js";import"./VSelectionControl-CijkNpW-.js";const Ue={class:"w-100 d-flex justify-end"},we={class:"w-100 d-flex justify-end"},Te={class:"text-center pt-2"},Se={class:"w-100 d-flex justify-end"},Be={class:"w-100 d-flex justify-end"},Ge={class:"text-center pt-2"},De={__name:"goldboxSellView",setup(Fe){const x=s(""),de=s(""),p=s(!1),ue=s(!1),N=s(null),se=s([{title:"نام",key:"seller.firstName"},{title:"نام خانوادگی",key:"seller.lastName"},{title:"مبلغ خرید (تومان)",key:"totalPrice"},{title:"وزن طلا (گرم)",key:"goldWeight"},{title:"تاریخ",key:"date"},{title:"زمان",key:"time"},{title:"شناسه پرداخت",key:"invoiceId"},{title:"وضعیت",key:"status"}]),ne=s([{title:"نام",key:"seller.firstName"},{title:"نام خانوادگی",key:"seller.lastName"},{title:"مبلغ خرید (تومان)",key:"totalPrice"},{title:"وزن طلا (گرم)",key:"goldWeight"},{title:"تاریخ",key:"date"},{title:"زمان",key:"time"},{title:"شناسه پرداخت",key:"invoiceId"},{title:"وضعیت",key:"status"}]),S=s(),V=s(),g=s(),B=s(),ie=s(),t=s({firstName:"",lastName:"",nationalCode:"",phoneNumber:"",tradeType:0,type:"sell",goldPrice:"",goldWeight:"",admin:"",accounter:"",startDate:"",startTime:"",endDate:"",endTime:"",invoiceId:"",status:"",destCardPan:""}),E=s(!0),L=s(!0),$=s(""),k=s(!1),b=s(50),v=s(1),re=s([10,25]),G=s(0),j=s(1),C=s(""),y=s(50),f=s(1),me=s([10,25]),D=s(0),A=s(1),P=s(""),U=async()=>{try{V.value=!0;const d=await Y.SellGoldBox({page:v.value,perPage:b.value,search:C.value},1);return G.value=d.data.totalItems,S.value=d.data.transActions,j.value=Math.ceil(G.value/b.value),d}catch(d){d.response.status==401&&(localStorage.clear(),W.replace("/login")),x.value=d.response.data.error||"خطایی رخ داده است!",p.value=!0,setTimeout(()=>{p.value=!1},1e4)}finally{V.value=!1}},pe=d=>{v.value=d.page,b.value=d.itemsPerPage,U()};w(C,Z.debounce(()=>{U()},1e3)),w([v,b],()=>{U()});const F=async()=>{try{g.value=!0;const d=await Y.SellGoldBox({page:f.value,perPage:y.value,search:P.value},0);return D.value=d.data.totalItems,B.value=d.data.transActions,A.value=Math.ceil(D.value/y.value),d}catch(d){d.response.status==401&&(localStorage.clear(),W.replace("/login")),x.value=d.response.data.error||"خطایی رخ داده است!",p.value=!0,setTimeout(()=>{p.value=!1},1e4)}finally{g.value=!1}},ve=d=>{f.value=d.page,y.value=d.itemsPerPage,F()};w(P,Z.debounce(()=>{F()},1e3)),w([f,y],()=>{GetCompleteGoldBoxBuyList()});const M=d=>d.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),O=[d=>/^\d{10}$/.test(d)||"کد ملی باید ۱۰ رقم باشد",d=>{if(!/^\d{10}$/.test(d))return!0;const e=+d[9],r=d.split("").slice(0,9).reduce((a,ce,Ve)=>a+ +ce*(10-Ve),0)%11;return r<2&&e===r||r>=2&&e+r===11||"کد ملی نامعتبر است"}],R=()=>{t.value.phoneNumber=t.value.phoneNumber.replace(/\D/g,"").slice(0,11)},z=[d=>/^09\d{9}$/.test(d)||"شماره معتبر نیست"],q=[d=>!!d,d=>/^\d+(\.\d{1,3})?$/.test(d)],fe=()=>{t.value.firstName="",t.value.lastName="",t.value.accounter="",t.value.admin="",t.value.endDate="",t.value.endTime="",t.value.goldPrice="",t.value.goldWeight="",t.value.invoiceId="",t.value.nationalCode="",t.value.phoneNumber="",t.value.startTime="",t.value.startDate="",t.value.destCardPan=""},J=async d=>{console.log(d);try{d=="completed"?V.value=!0:d=="failed"&&(g.value=!0),t.value.status=d;const e=await Ne.SubmitFilterInvoice(t.value);return $.value=e.link,d=="completed"?(S.value=e.data.transActions,E.value=!1):d=="failed"&&(B.value=e.data.transActions,L.value=!1),e}catch(e){e.response.status==401&&(localStorage.clear(),W.replace("/login")),x.value=e.response.data.error||"خطایی رخ داده است!",p.value=!0,setTimeout(()=>{p.value=!1},1e4)}finally{V.value=!1,g.value=!1}},K=async()=>{k.value=!0,window.location.href=$.value,setTimeout(()=>{k.value=!1},5e3)};return be(()=>{U(),F()}),(d,e)=>{const r=xe("persian-date-picker");return H(),ye("div",null,[l(I,null,{default:o(()=>[l(u,null,{default:o(()=>[l(ke,{modelValue:N.value,"onUpdate:modelValue":[e[0]||(e[0]=a=>N.value=a),fe],"align-tabs":"center"},{default:o(()=>[l(h,{value:"one"},{default:o(()=>e[32]||(e[32]=[m("فروش های موفق")])),_:1}),l(h,{value:"two"},{default:o(()=>e[33]||(e[33]=[m("فروش های ناموفق")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(u,{cols:"12"},{default:o(()=>[l(Pe,null,{default:o(()=>[l(Ce,{modelValue:N.value,"onUpdate:modelValue":e[31]||(e[31]=a=>N.value=a)},{default:o(()=>[l(ee,{value:"one"},{default:o(()=>[l(I,{class:"filter my-3"},{default:o(()=>[l(u,{cols:"6",md:"3"},{default:o(()=>[l(r,{modelValue:t.value.startDate,"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.startDate=a),placeholder:"از تاریخ"},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(r,{type:"time",modelValue:t.value.startTime,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.startTime=a),placeholder:"از زمان",format:"HH:mm:ss"},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(r,{modelValue:t.value.endDate,"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.endDate=a),placeholder:"تا تاریخ"},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(r,{type:"time",modelValue:t.value.endTime,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.endTime=a),placeholder:"تا زمان",format:"HH:mm:ss"},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(n,{modelValue:t.value.firstName,"onUpdate:modelValue":e[5]||(e[5]=a=>t.value.firstName=a),label:"نام",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(n,{modelValue:t.value.lastName,"onUpdate:modelValue":e[6]||(e[6]=a=>t.value.lastName=a),label:"نام خانوادگی",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(n,{modelValue:t.value.phoneNumber,"onUpdate:modelValue":e[7]||(e[7]=a=>t.value.phoneNumber=a),label:"شماره موبایل",density:"compact",variant:"outlined",rules:z,onInput:R},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(n,{modelValue:t.value.nationalCode,"onUpdate:modelValue":e[8]||(e[8]=a=>t.value.nationalCode=a),label:"کد ملی",density:"compact",variant:"outlined",rules:O},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(n,{modelValue:t.value.goldPrice,"onUpdate:modelValue":e[9]||(e[9]=a=>t.value.goldPrice=a),label:"قیمت طلا",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(n,{modelValue:t.value.goldWeight,"onUpdate:modelValue":e[10]||(e[10]=a=>t.value.goldWeight=a),label:"وزن طلا",density:"compact",variant:"outlined",rules:q},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(n,{modelValue:t.value.admin,"onUpdate:modelValue":e[11]||(e[11]=a=>t.value.admin=a),label:"ادمین",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(n,{modelValue:t.value.accounter,"onUpdate:modelValue":e[12]||(e[12]=a=>t.value.accounter=a),label:"حسابدار",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{md:"6",class:"d-none d-md-flex"}),l(u,{cols:"12",md:"3"},{default:o(()=>[i("div",Ue,[l(T,{"prepend-icon":"ri-loop-left-line",variant:"tonal",block:"",onClick:e[13]||(e[13]=a=>J("completed"))},{default:o(()=>e[34]||(e[34]=[m("به روز رسانی")])),_:1})])]),_:1}),l(u,{cols:"12",md:"3"},{default:o(()=>[i("div",we,[l(T,{"prepend-icon":"ri-file-excel-line",block:"",disabled:E.value,onClick:K,loading:k.value},{default:o(()=>e[35]||(e[35]=[m("خروجی اکسل")])),_:1},8,["disabled","loading"])])]),_:1})]),_:1}),l(le,{title:"فروش موفق"},{default:o(()=>[e[36]||(e[36]=i("ul",{class:"listGuide"},[i("li",null," معاملاتی که فرآیند فروش آن‌ها توسط کاربران در سایت و اپلیکیشن انجام شده است ")],-1)),l(n,{modelValue:C.value,"onUpdate:modelValue":e[14]||(e[14]=a=>C.value=a),label:"جستجو","prepend-inner-icon":"ri-search-line",class:"ma-3"},null,8,["modelValue"]),l(ae,{headers:se.value,items:S.value,loading:V.value,page:v.value,"items-per-page":b.value,"server-items-length":G.value,"items-per-page-options":re.value,"onUpdate:options":pe},{"item.totalPrice":o(({item:a})=>[i("p",null,c(M(a.totalPrice)),1)]),"item.goldWeight":o(({item:a})=>[i("p",null,c((+a.goldWeight).toFixed(3)),1)]),"item.status":o(({item:a})=>[i("div",null,[l(oe,{text:a.status=="completed"?"موفق":"نامشخص",color:a.status=="completed"?"#00853f":"#66666",size:"small"},null,8,["text","color"])])]),bottom:o(()=>[i("div",Te,[l(te,{modelValue:v.value,"onUpdate:modelValue":e[15]||(e[15]=a=>v.value=a),length:j.value,"total-visible":4},null,8,["modelValue","length"])])]),_:1},8,["headers","items","loading","page","items-per-page","server-items-length","items-per-page-options"])]),_:1})]),_:1}),l(ee,{value:"two"},{default:o(()=>[l(I,{class:"filter my-3"},{default:o(()=>[l(u,{cols:"6",md:"3"},{default:o(()=>[l(r,{modelValue:t.value.startDate,"onUpdate:modelValue":e[16]||(e[16]=a=>t.value.startDate=a),placeholder:"از تاریخ"},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(r,{type:"time",modelValue:t.value.startTime,"onUpdate:modelValue":e[17]||(e[17]=a=>t.value.startTime=a),placeholder:"از زمان",format:"HH:mm:ss"},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(r,{modelValue:t.value.endDate,"onUpdate:modelValue":e[18]||(e[18]=a=>t.value.endDate=a),placeholder:"تا تاریخ"},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(r,{type:"time",modelValue:t.value.endTime,"onUpdate:modelValue":e[19]||(e[19]=a=>t.value.endTime=a),placeholder:"تا زمان",format:"HH:mm:ss"},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(n,{modelValue:t.value.firstName,"onUpdate:modelValue":e[20]||(e[20]=a=>t.value.firstName=a),label:"نام",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(n,{modelValue:t.value.lastName,"onUpdate:modelValue":e[21]||(e[21]=a=>t.value.lastName=a),label:"نام خانوادگی",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(n,{modelValue:t.value.phoneNumber,"onUpdate:modelValue":e[22]||(e[22]=a=>t.value.phoneNumber=a),label:"شماره موبایل",density:"compact",variant:"outlined",rules:z,onInput:R},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(n,{modelValue:t.value.nationalCode,"onUpdate:modelValue":e[23]||(e[23]=a=>t.value.nationalCode=a),label:"کد ملی",density:"compact",variant:"outlined",rules:O},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(n,{modelValue:t.value.goldPrice,"onUpdate:modelValue":e[24]||(e[24]=a=>t.value.goldPrice=a),label:"قیمت طلا",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(n,{modelValue:t.value.goldWeight,"onUpdate:modelValue":e[25]||(e[25]=a=>t.value.goldWeight=a),label:"وزن طلا",density:"compact",variant:"outlined",rules:q},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(n,{modelValue:t.value.admin,"onUpdate:modelValue":e[26]||(e[26]=a=>t.value.admin=a),label:"ادمین",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{cols:"6",md:"3"},{default:o(()=>[l(n,{modelValue:t.value.accounter,"onUpdate:modelValue":e[27]||(e[27]=a=>t.value.accounter=a),label:"حسابدار",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(u,{md:"6",class:"d-none d-md-flex"}),l(u,{cols:"12",md:"3"},{default:o(()=>[i("div",Se,[l(T,{"prepend-icon":"ri-loop-left-line",variant:"tonal",block:"",onClick:e[28]||(e[28]=a=>J("failed"))},{default:o(()=>e[37]||(e[37]=[m("به روز رسانی")])),_:1})])]),_:1}),l(u,{cols:"12",md:"3"},{default:o(()=>[i("div",Be,[l(T,{"prepend-icon":"ri-file-excel-line",block:"",disabled:L.value,onClick:K,loading:k.value},{default:o(()=>e[38]||(e[38]=[m("خروجی اکسل")])),_:1},8,["disabled","loading"])])]),_:1})]),_:1}),l(le,{title:"فروش ناموفق"},{default:o(()=>[e[39]||(e[39]=i("ul",{class:"listGuide"},[i("li",null," معاملاتی که فرایند فروش آنها توسط کاربران از طریق سایت یا اپلیکیشن صورت گرفته، اما به‌دلیل انصراف کاربر یا عوامل دیگر لغو شده‌اند. ")],-1)),l(n,{modelValue:P.value,"onUpdate:modelValue":e[29]||(e[29]=a=>P.value=a),label:"جستجو","prepend-inner-icon":"ri-search-line",class:"ma-3"},null,8,["modelValue"]),l(ae,{headers:ne.value,items:B.value,search:ie.value,loading:g.value,page:f.value,"items-per-page":y.value,"server-items-length":D.value,"items-per-page-options":me.value,"onUpdate:options":ve},{"item.totalPrice":o(({item:a})=>[i("p",null,c(M(a.totalPrice)),1)]),"item.goldWeight":o(({item:a})=>[i("p",null,c((+a.goldWeight).toFixed(3)),1)]),"item.status":o(({item:a})=>[i("div",null,[l(oe,{text:a.status=="failed"?"ناموفق":"نامشخص",color:a.status=="failed"?"#ff0000":"#66666",size:"small"},null,8,["text","color"])])]),bottom:o(()=>[i("div",Ge,[l(te,{modelValue:f.value,"onUpdate:modelValue":e[30]||(e[30]=a=>f.value=a),length:A.value,"total-visible":4},null,8,["modelValue","length"])])]),_:1},8,["headers","items","search","loading","page","items-per-page","server-items-length","items-per-page-options"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),p.value?(H(),Q(_,{key:0,color:"error",border:"bottom",elevation:"2",class:"k-alert alert-animatiton",closable:""},{default:o(()=>[m(c(x.value),1)]),_:1})):X("",!0),ue.value?(H(),Q(_,{key:1,color:"success",border:"bottom",elevation:"2",class:"k-alert alert-animatiton",closable:""},{default:o(()=>[m(c(de.value),1)]),_:1})):X("",!0)])}}},ll=ge(De,[["__scopeId","data-v-e9b7d093"]]);export{ll as default};
