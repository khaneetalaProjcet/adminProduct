import{G as S}from"./goldbox-Bfa7e3a8.js";import{_ as A,r as i,c as H,b as e,w as t,a7 as J,e as K,h as O,F as P,o as z,a1 as c,a2 as u,a as s,a4 as V,C as g,t as f,V as T}from"./index-qRwjmnz2.js";import{V as D}from"./VDialog-D8Agev-f.js";import{V as Q}from"./VAlert-DM9ZYxPA.js";import{V as p,a as k}from"./VCard-D-38SOLN.js";import{V as I}from"./VTextField-C8XDWrtH.js";import"./api-CUxBsuld.js";import"./dialog-transition-yTsYZrhR.js";import"./index-DlIFWUd_.js";import"./index-D7Dh4m33.js";import"./createSimpleFunctional-DCTVPnrB.js";import"./VAvatar-DWeimtuK.js";import"./VImg-DogQHBKL.js";const X={class:"d-flex align-center justify-start"},Y={class:"d-flex align-center justify-start"},Z={class:"d-flex align-center justify-start"},h={class:"d-flex align-center justify-start"},ll={class:"d-flex justify-center align-center"},el={class:"d-flex align-center justify-start"},al={class:"d-flex align-center justify-start"},tl={class:"d-flex align-center justify-start"},sl={class:"d-flex align-center justify-start"},ol={class:"d-flex align-center justify-start"},rl={class:"d-flex justify-end"},ul={class:"w-100 d-flex justify-space-between mt-4"},nl={__name:"EmergencyTransferView",setup(dl){const r=i({sender:"",reciever:"",goldWeight:""}),$=i(!1),W=i(!1),w=i(!1),B=i(!1),y=i(!1),m=i(!1),N=i(!1),b=i(""),d=i({firstName:"",lastName:"",nationalCode:"",goldWeight:""}),n=i({firstName:"",lastName:"",nationalCode:"",phoneNumber:"",goldWeight:"",goldBlock:0}),j=i(!1),G=async()=>{var o;try{W.value=!0;const l=await S.inquiryGoldBoxSender(r.value.sender);return w.value=!0,d.value.firstName=l==null?void 0:l.firstName,d.value.lastName=l==null?void 0:l.lastName,d.value.nationalCode=l==null?void 0:l.nationalCode,d.value.goldWeight=(o=l==null?void 0:l.wallet)==null?void 0:o.goldWeight,l}catch(l){l.response.status==401&&(localStorage.clear(),router.replace("/login")),b.value=l.response.data.error||"خطایی رخ داده است!",m.value=!0,setTimeout(()=>{m.value=!1},1e4)}finally{W.value=!1}},U=async()=>{var o,l,a,C,_;try{$.value=!0;const v=await S.inquiryGoldBoxReciever(r.value.reciever);return B.value=!0,n.value.firstName=(o=v.data)==null?void 0:o.firstName,n.value.lastName=(l=v.data)==null?void 0:l.lastName,n.value.nationalCode=(a=v.data)==null?void 0:a.nationalCode,n.value.goldWeight=(C=v.data)==null?void 0:C.goldWeight,n.value.goldBlock=(_=v.data)==null?void 0:_.goldBlock,v}catch(v){v.response.status==401&&(localStorage.clear(),router.replace("/login")),b.value=v.response.data.error||"خطایی رخ داده است!",m.value=!0,setTimeout(()=>{m.value=!1},1e4)}finally{$.value=!1}},q=async()=>{try{j.value=!0;const o=await S.confirmTransfer(r.value);return y.value=!1,E(),o}catch(o){o.response.status==401&&(localStorage.clear(),router.replace("/login")),b.value=o.response.data.error||"خطایی رخ داده است!",m.value=!0,setTimeout(()=>{m.value=!1},1e4)}finally{j.value=!1}},E=async()=>{N.value=!0,setInterval(()=>{N.value=!1,r.value.sender="",r.value.reciever="",r.value.goldWeight="",d.value.firstName="",d.value.lastName="",d.value.goldWeight="",d.value.nationalCode="",n.value.firstName="",n.value.lastName="",n.value.goldBlock="",n.value.goldWeight="",n.value.nationalCode="",n.value.phoneNumber=""},3e3)},F=()=>{r.value.sender=r.value.sender.replace(/\D/g,"").slice(0,10),x.every(o=>o(r.value.sender)===!0)},R=()=>{r.value.reciever=r.value.reciever.replace(/\D/g,"").slice(0,10),x.every(o=>o(r.value.reciever)===!0)},x=[o=>!!o||"کد ملی الزامی است",o=>/^\d{10}$/.test(o)||"کد ملی باید ۱۰ رقم باشد",o=>{if(!/^\d{10}$/.test(o))return!0;const l=+o[9],a=o.split("").slice(0,9).reduce((C,_,v)=>C+ +_*(10-v),0)%11;return a<2&&l===a||a>=2&&l+a===11||"کد ملی نامعتبر است"}],L=()=>{r.value.goldWeight=r.value.goldWeight.replace(/[^0-9.]/g,"")},M=[o=>!!o||"مقدار ورودی نمی‌تواند خالی باشد"];return(o,l)=>(z(),H(P,null,[e(J,null,{default:t(()=>[e(c,null,{default:t(()=>[e(u,{cols:"12",class:"my-2"},{default:t(()=>[e(p,{class:"guide-section"},{default:t(()=>[e(k,null,{default:t(()=>l[9]||(l[9]=[s("h4",{class:"guideSection-title"},"راهنمای انتقال اضطراری",-1),s("ul",null,[s("li",null,"شخص انتقال دهنده، حتما باید جزو کاربران احراز نشده باشد."),s("li",null,"شخص انتقال گیرنده حتما باید جزو کاربران احراز شده باشد."),s("li",null,"مقدر انتقال باید برابر باشد با تمام موجودی شخص انتقال دهنده.")],-1)])),_:1})]),_:1})]),_:1}),e(u,{cols:"12",class:"my-2"},{default:t(()=>[e(p,null,{default:t(()=>[e(k,null,{default:t(()=>[l[15]||(l[15]=s("h3",{class:"mb-2"},"اطلاعات انتقال دهنده",-1)),e(c,null,{default:t(()=>[e(u,{cols:"12",md:"6"},{default:t(()=>[e(I,{modelValue:r.value.sender,"onUpdate:modelValue":l[0]||(l[0]=a=>r.value.sender=a),label:"کد ملی",variant:"outlined",rules:x,onInput:F},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",md:"6"},{default:t(()=>[e(V,{class:"h-100 py-2",color:"primary",size:"large",variant:"elevated",block:"",onClick:l[1]||(l[1]=a=>G()),loading:W.value},{default:t(()=>l[10]||(l[10]=[g(" استعلام انتقال دهنده ")])),_:1},8,["loading"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(u,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",X,[l[11]||(l[11]=s("p",null,"نام : ",-1)),s("p",null,f((a=d.value)==null?void 0:a.firstName),1)])]}),_:1}),e(u,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",Y,[l[12]||(l[12]=s("p",null,"نام خانوادگی : ",-1)),s("p",null,f((a=d.value)==null?void 0:a.lastName),1)])]}),_:1}),e(u,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",Z,[l[13]||(l[13]=s("p",null,"کد ملی : ",-1)),s("p",null,f((a=d.value)==null?void 0:a.nationalCode),1)])]}),_:1}),e(u,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",h,[l[14]||(l[14]=s("p",null,"موجودی صندوق طلا : ",-1)),s("p",null,f((a=d.value)==null?void 0:a.goldWeight)+" گرم",1)])]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(u,{cols:"12"},{default:t(()=>[s("div",ll,[e(T,{icon:"ri-arrow-up-down-line",color:"#000"})])]),_:1}),e(u,{cols:"12",class:"my-2"},{default:t(()=>[e(p,null,{default:t(()=>[e(k,null,{default:t(()=>[l[22]||(l[22]=s("h3",{class:"mb-2"},"اطلاعات انتقال گیرنده",-1)),e(c,null,{default:t(()=>[e(u,{cols:"12",md:"6"},{default:t(()=>[e(I,{modelValue:r.value.reciever,"onUpdate:modelValue":l[2]||(l[2]=a=>r.value.reciever=a),label:"کد ملی",variant:"outlined",rules:x,onInput:R},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",md:"6"},{default:t(()=>[e(V,{class:"h-100 py-2",color:"primary",size:"large",variant:"elevated",block:"",onClick:l[3]||(l[3]=a=>U())},{default:t(()=>l[16]||(l[16]=[g(" استعلام انتقال گیرنده ")])),_:1})]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(u,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",el,[l[17]||(l[17]=s("p",null,"نام : ",-1)),s("p",null,f((a=n.value)==null?void 0:a.firstName),1)])]}),_:1}),e(u,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",al,[l[18]||(l[18]=s("p",null,"نام خانوادگی : ",-1)),s("p",null,f((a=n.value)==null?void 0:a.lastName),1)])]}),_:1}),e(u,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",tl,[l[19]||(l[19]=s("p",null,"کد ملی : ",-1)),s("p",null,f((a=n.value)==null?void 0:a.nationalCode),1)])]}),_:1}),e(u,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",sl,[l[20]||(l[20]=s("p",null,"طلای در انتظار : ",-1)),s("p",null,f((a=n.value)==null?void 0:a.goldBlock),1)])]}),_:1}),e(u,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",ol,[l[21]||(l[21]=s("p",null,"موجودی صندوق طلا : ",-1)),s("p",null,f((a=n.value)==null?void 0:a.goldWeight)+" گرم",1)])]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(u,{cols:"12",class:"my-2"},{default:t(()=>[e(p,null,{default:t(()=>[e(k,null,{default:t(()=>[e(c,null,{default:t(()=>[e(u,{cols:"12",md:"6"},{default:t(()=>[e(I,{modelValue:r.value.goldWeight,"onUpdate:modelValue":l[4]||(l[4]=a=>r.value.goldWeight=a),label:"وزن (گرم)",variant:"outlined",rules:M,onInput:L,disabled:w.value!=!0||B.value!=!0},null,8,["modelValue","disabled"])]),_:1}),e(u,{cols:"12",md:"6"},{default:t(()=>[s("div",rl,[e(V,{class:"py-2 px-10",color:"#c61a09",size:"large",variant:"elevated",disabled:w.value!=!0||B.value!=!0||r.value.goldWeight!=d.value.goldWeight,onClick:l[5]||(l[5]=a=>y.value=!0)},{default:t(()=>l[23]||(l[23]=[g(" تایید انتقال ")])),_:1},8,["disabled"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(D,{modelValue:y.value,"onUpdate:modelValue":l[7]||(l[7]=a=>y.value=a),"max-width":"500"},{default:t(()=>[e(p,{title:"تایید انتقال",class:"modal-card"},{default:t(()=>[e(T,{class:"mt-3 mb-6",icon:"ri-error-warning-fill",color:"#c61a09"}),l[26]||(l[26]=s("h4",{class:"my-3"}," آیا از این انتقال مطمئن هستید؟ ",-1)),l[27]||(l[27]=s("p",{class:"my-3"},"در صورت انجام این انتقال، امکان بازگشت وجود ندارد",-1)),s("div",ul,[e(V,{color:"#c61a09",size:"large",variant:"outlined",onClick:l[6]||(l[6]=a=>y.value=!1)},{default:t(()=>l[24]||(l[24]=[g(" لغو ")])),_:1}),e(V,{color:"#c61a09",size:"large",variant:"elevated",onClick:q,loading:j.value},{default:t(()=>l[25]||(l[25]=[g(" تایید ")])),_:1},8,["loading"])])]),_:1})]),_:1},8,["modelValue"]),e(D,{modelValue:N.value,"onUpdate:modelValue":l[8]||(l[8]=a=>N.value=a),"max-width":"500"},{default:t(()=>[e(p,{title:"تایید انتقال",class:"modal-card"},{default:t(()=>[e(T,{class:"mt-3 mb-6",icon:"ri-checkbox-circle-fill",color:"#0b8707"}),l[28]||(l[28]=s("h4",null," انتقال طلا با موفقیت انجام شد ",-1))]),_:1})]),_:1},8,["modelValue"]),m.value?(z(),K(Q,{key:0,color:"error",border:"bottom",elevation:"2",class:"k-alert alert-animatiton",closable:""},{default:t(()=>[g(f(b.value),1)]),_:1})):O("",!0)],64))}},_l=A(nl,[["__scopeId","data-v-933bbeb1"]]);export{_l as default};
