import{G as B}from"./goldbox-sPdrx6I8.js";import{_ as A,r as d,c as H,b as e,w as t,a7 as J,e as K,h as O,F as P,o as $,a1 as c,a2 as r,a as s,a4 as V,C as g,t as f,V as T}from"./index-M-ksGW5I.js";import{V as D}from"./VDialog-CdhYHTr_.js";import{V as Q}from"./VAlert-BteyOiC9.js";import{V as p,a as k}from"./VCard-CBMrbeTG.js";import{V as I}from"./VTextField-D32llGkt.js";import{V as X}from"./VChip-BdJUcCpM.js";import"./api-JkepSPcn.js";import"./dialog-transition-C6lGH3iu.js";import"./index-DLmfDg-L.js";import"./index-C7C0uFbA.js";import"./createSimpleFunctional-TTDR03ld.js";import"./VAvatar-D3dcEOar.js";import"./VImg-BzFsDdol.js";const Y={class:"d-flex align-center justify-start"},Z={class:"d-flex align-center justify-start"},h={class:"d-flex align-center justify-start"},ll={class:"d-flex align-center justify-start"},el={class:"d-flex align-center justify-start"},al={class:"d-flex justify-center align-center"},tl={class:"d-flex align-center justify-start"},sl={class:"d-flex align-center justify-start"},ol={class:"d-flex align-center justify-start"},ul={class:"d-flex align-center justify-start"},rl={class:"d-flex align-center justify-start"},il={class:"d-flex justify-end"},nl={class:"w-100 d-flex justify-space-between mt-4"},dl={__name:"EmergencyTransferView",setup(vl){const u=d({sender:"",reciever:"",goldWeight:""}),z=d(!1),W=d(!1),S=d(!1),w=d(!1),y=d(!1),m=d(!1),x=d(!1),N=d(""),i=d({firstName:"",lastName:"",nationalCode:"",goldWeight:"",verificationStatus:""}),n=d({firstName:"",lastName:"",nationalCode:"",phoneNumber:"",goldWeight:"",goldBlock:0}),j=d(!1),G=async()=>{var o;try{W.value=!0;const l=await B.inquiryGoldBoxSender(u.value.sender);return S.value=!0,i.value.firstName=l==null?void 0:l.firstName,i.value.lastName=l==null?void 0:l.lastName,i.value.nationalCode=l==null?void 0:l.nationalCode,i.value.goldWeight=(o=l==null?void 0:l.wallet)==null?void 0:o.goldWeight,i.value.verificationStatus=l==null?void 0:l.verificationStatus,l}catch(l){l.response.status==401&&(localStorage.clear(),router.replace("/login")),N.value=l.response.data.error||"خطایی رخ داده است!",m.value=!0,setTimeout(()=>{m.value=!1},1e4)}finally{W.value=!1}},U=async()=>{var o,l,a,_,b;try{z.value=!0;const v=await B.inquiryGoldBoxReciever(u.value.reciever);return w.value=!0,n.value.firstName=(o=v.data)==null?void 0:o.firstName,n.value.lastName=(l=v.data)==null?void 0:l.lastName,n.value.nationalCode=(a=v.data)==null?void 0:a.nationalCode,n.value.goldWeight=(_=v.data)==null?void 0:_.goldWeight,n.value.goldBlock=(b=v.data)==null?void 0:b.goldBlock,v}catch(v){v.response.status==401&&(localStorage.clear(),router.replace("/login")),N.value=v.response.data.error||"خطایی رخ داده است!",m.value=!0,setTimeout(()=>{m.value=!1},1e4)}finally{z.value=!1}},q=async()=>{try{j.value=!0;const o=await B.confirmTransfer(u.value);return y.value=!1,E(),o}catch(o){o.response.status==401&&(localStorage.clear(),router.replace("/login")),N.value=o.response.data.error||"خطایی رخ داده است!",m.value=!0,setTimeout(()=>{m.value=!1},1e4)}finally{j.value=!1}},E=async()=>{x.value=!0,setInterval(()=>{x.value=!1,u.value.sender="",u.value.reciever="",u.value.goldWeight="",i.value.firstName="",i.value.lastName="",i.value.goldWeight="",i.value.nationalCode="",i.value.verificationStatus="",n.value.firstName="",n.value.lastName="",n.value.goldBlock="",n.value.goldWeight="",n.value.nationalCode="",n.value.phoneNumber=""},3e3)},F=()=>{u.value.sender=u.value.sender.replace(/\D/g,"").slice(0,10),C.every(o=>o(u.value.sender)===!0)},R=()=>{u.value.reciever=u.value.reciever.replace(/\D/g,"").slice(0,10),C.every(o=>o(u.value.reciever)===!0)},C=[o=>!!o||"کد ملی الزامی است",o=>/^\d{10}$/.test(o)||"کد ملی باید ۱۰ رقم باشد",o=>{if(!/^\d{10}$/.test(o))return!0;const l=+o[9],a=o.split("").slice(0,9).reduce((_,b,v)=>_+ +b*(10-v),0)%11;return a<2&&l===a||a>=2&&l+a===11||"کد ملی نامعتبر است"}],L=()=>{u.value.goldWeight=u.value.goldWeight.replace(/[^0-9.]/g,"")},M=[o=>!!o||"مقدار ورودی نمی‌تواند خالی باشد"];return(o,l)=>($(),H(P,null,[e(J,null,{default:t(()=>[e(c,null,{default:t(()=>[e(r,{cols:"12",class:"my-2"},{default:t(()=>[e(p,{class:"guide-section"},{default:t(()=>[e(k,null,{default:t(()=>l[9]||(l[9]=[s("h4",{class:"guideSection-title"},"راهنمای انتقال اضطراری",-1),s("ul",null,[s("li",null,"شخص انتقال دهنده، حتما باید جزو کاربران احراز نشده باشد."),s("li",null,"شخص انتقال گیرنده حتما باید جزو کاربران احراز شده باشد."),s("li",null,"مقدر انتقال باید برابر باشد با تمام موجودی شخص انتقال دهنده.")],-1)])),_:1})]),_:1})]),_:1}),e(r,{cols:"12",class:"my-2"},{default:t(()=>[e(p,null,{default:t(()=>[e(k,null,{default:t(()=>[l[16]||(l[16]=s("h3",{class:"mb-2"},"اطلاعات انتقال دهنده",-1)),e(c,null,{default:t(()=>[e(r,{cols:"12",md:"6"},{default:t(()=>[e(I,{modelValue:u.value.sender,"onUpdate:modelValue":l[0]||(l[0]=a=>u.value.sender=a),label:"کد ملی",variant:"outlined",rules:C,onInput:F},null,8,["modelValue"])]),_:1}),e(r,{cols:"12",md:"6"},{default:t(()=>[e(V,{class:"py-2",color:"primary",size:"large",variant:"elevated",block:"",onClick:l[1]||(l[1]=a=>G()),loading:W.value},{default:t(()=>l[10]||(l[10]=[g(" استعلام انتقال دهنده ")])),_:1},8,["loading"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(r,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",Y,[l[11]||(l[11]=s("p",null,"نام : ",-1)),s("p",null,f((a=i.value)==null?void 0:a.firstName),1)])]}),_:1}),e(r,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",Z,[l[12]||(l[12]=s("p",null,"نام خانوادگی : ",-1)),s("p",null,f((a=i.value)==null?void 0:a.lastName),1)])]}),_:1}),e(r,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",h,[l[13]||(l[13]=s("p",null,"کد ملی : ",-1)),s("p",null,f((a=i.value)==null?void 0:a.nationalCode),1)])]}),_:1}),e(r,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",ll,[l[14]||(l[14]=s("p",null,"موجودی صندوق طلا : ",-1)),s("p",null,f((a=i.value)==null?void 0:a.goldWeight)+" گرم",1)])]}),_:1}),e(r,{cols:"12",md:"4"},{default:t(()=>[s("div",el,[l[15]||(l[15]=s("p",{class:"mb-0"},"وضعیت : ",-1)),e(X,{text:i.value.verificationStatus==1?"منتقل شده":i.value.verificationStatus==2?"منتقل نشده":"نامشخص",color:i.value.verificationStatus==1?"#00853f":i.value.verificationStatus==2?"#ff0000":"#66666",size:"small"},null,8,["text","color"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(r,{cols:"12"},{default:t(()=>[s("div",al,[e(T,{icon:"ri-arrow-up-down-line",color:"#000"})])]),_:1}),e(r,{cols:"12",class:"my-2"},{default:t(()=>[e(p,null,{default:t(()=>[e(k,null,{default:t(()=>[l[23]||(l[23]=s("h3",{class:"mb-2"},"اطلاعات انتقال گیرنده",-1)),e(c,null,{default:t(()=>[e(r,{cols:"12",md:"6"},{default:t(()=>[e(I,{modelValue:u.value.reciever,"onUpdate:modelValue":l[2]||(l[2]=a=>u.value.reciever=a),label:"کد ملی",variant:"outlined",rules:C,onInput:R},null,8,["modelValue"])]),_:1}),e(r,{cols:"12",md:"6"},{default:t(()=>[e(V,{class:"py-2",color:"primary",size:"large",variant:"elevated",block:"",onClick:l[3]||(l[3]=a=>U())},{default:t(()=>l[17]||(l[17]=[g(" استعلام انتقال گیرنده ")])),_:1})]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(r,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",tl,[l[18]||(l[18]=s("p",null,"نام : ",-1)),s("p",null,f((a=n.value)==null?void 0:a.firstName),1)])]}),_:1}),e(r,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",sl,[l[19]||(l[19]=s("p",null,"نام خانوادگی : ",-1)),s("p",null,f((a=n.value)==null?void 0:a.lastName),1)])]}),_:1}),e(r,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",ol,[l[20]||(l[20]=s("p",null,"کد ملی : ",-1)),s("p",null,f((a=n.value)==null?void 0:a.nationalCode),1)])]}),_:1}),e(r,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",ul,[l[21]||(l[21]=s("p",null,"طلای در انتظار : ",-1)),s("p",null,f((a=n.value)==null?void 0:a.goldBlock),1)])]}),_:1}),e(r,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",rl,[l[22]||(l[22]=s("p",null,"موجودی صندوق طلا : ",-1)),s("p",null,f((a=n.value)==null?void 0:a.goldWeight)+" گرم",1)])]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(r,{cols:"12",class:"my-2"},{default:t(()=>[e(p,null,{default:t(()=>[e(k,null,{default:t(()=>[e(c,null,{default:t(()=>[e(r,{cols:"12",md:"6"},{default:t(()=>[e(I,{modelValue:u.value.goldWeight,"onUpdate:modelValue":l[4]||(l[4]=a=>u.value.goldWeight=a),label:"وزن (گرم)",variant:"outlined",rules:M,onInput:L,disabled:S.value!=!0||w.value!=!0},null,8,["modelValue","disabled"])]),_:1}),e(r,{cols:"12",md:"6"},{default:t(()=>[s("div",il,[e(V,{class:"py-2 px-10",color:"#c61a09",size:"large",variant:"elevated",disabled:S.value!=!0||w.value!=!0||u.value.goldWeight!=i.value.goldWeight,onClick:l[5]||(l[5]=a=>y.value=!0)},{default:t(()=>l[24]||(l[24]=[g(" تایید انتقال ")])),_:1},8,["disabled"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(D,{modelValue:y.value,"onUpdate:modelValue":l[7]||(l[7]=a=>y.value=a),"max-width":"500"},{default:t(()=>[e(p,{title:"تایید انتقال",class:"modal-card"},{default:t(()=>[e(T,{class:"mt-3 mb-6",icon:"ri-error-warning-fill",color:"#c61a09"}),l[27]||(l[27]=s("h4",{class:"my-3"}," آیا از این انتقال مطمئن هستید؟ ",-1)),l[28]||(l[28]=s("p",{class:"my-3"},"در صورت انجام این انتقال، امکان بازگشت وجود ندارد",-1)),s("div",nl,[e(V,{color:"#c61a09",size:"large",variant:"outlined",onClick:l[6]||(l[6]=a=>y.value=!1)},{default:t(()=>l[25]||(l[25]=[g(" لغو ")])),_:1}),e(V,{color:"#c61a09",size:"large",variant:"elevated",onClick:q,loading:j.value},{default:t(()=>l[26]||(l[26]=[g(" تایید ")])),_:1},8,["loading"])])]),_:1})]),_:1},8,["modelValue"]),e(D,{modelValue:x.value,"onUpdate:modelValue":l[8]||(l[8]=a=>x.value=a),"max-width":"500"},{default:t(()=>[e(p,{title:"تایید انتقال",class:"modal-card"},{default:t(()=>[e(T,{class:"mt-3 mb-6",icon:"ri-checkbox-circle-fill",color:"#0b8707"}),l[29]||(l[29]=s("h4",null," انتقال طلا با موفقیت انجام شد ",-1))]),_:1})]),_:1},8,["modelValue"]),m.value?($(),K(Q,{key:0,color:"error",border:"bottom",elevation:"2",class:"k-alert alert-animatiton",closable:""},{default:t(()=>[g(f(N.value),1)]),_:1})):O("",!0)],64))}},Sl=A(dl,[["__scopeId","data-v-a4d0da8f"]]);export{Sl as default};
