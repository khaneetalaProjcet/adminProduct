import{G as B}from"./goldbox-C3lY_pSQ.js";import{_ as H,r as d,c as J,b as e,w as t,a7 as K,e as O,h as P,F as Q,o as $,a1 as c,a2 as u,a as s,a4 as V,C as g,t as f,V as T}from"./index-DdjiCice.js";import{V as G}from"./VDialog-CYc_tt1j.js";import{V as X}from"./VAlert-BAGR_jkA.js";import{V as p,a as b}from"./VCard-CFRcwvtS.js";import{V as I}from"./VTextField-B3AbLhzi.js";import{V as Y}from"./VChip-hMylpIDe.js";import"./api-DzgwOJNq.js";import"./dialog-transition-D5sV5wMs.js";import"./index-mq9U1w8r.js";import"./index-sm_fwGAS.js";import"./createSimpleFunctional-DGEvUO6K.js";import"./VAvatar-Df2CKyCj.js";import"./VImg-QLhu4NWf.js";const Z={class:"d-flex align-center justify-start"},h={class:"d-flex align-center justify-start"},ll={class:"d-flex align-center justify-start"},el={class:"d-flex align-center justify-start"},al={class:"d-flex align-center justify-start"},tl={class:"d-flex justify-center align-center"},sl={class:"d-flex align-center justify-start"},ol={class:"d-flex align-center justify-start"},ul={class:"d-flex align-center justify-start"},rl={class:"d-flex align-center justify-start"},nl={class:"d-flex align-center justify-start"},il={class:"d-flex justify-end"},dl={class:"w-100 d-flex justify-space-between mt-4"},vl={__name:"EmergencyTransferView",setup(fl){const r=d({sender:"",reciever:"",goldWeight:""}),z=d(!1),k=d(!1),S=d(!1),W=d(!1),y=d(!1),m=d(!1),x=d(!1),N=d(""),n=d({firstName:"",lastName:"",nationalCode:"",goldWeight:"",verificationStatus:""}),i=d({firstName:"",lastName:"",nationalCode:"",phoneNumber:"",goldWeight:"",goldBlock:0}),w=d(!1),R=async()=>{var o;try{k.value=!0;const l=await B.inquiryGoldBoxSender(r.value.sender);return S.value=!0,n.value.firstName=l==null?void 0:l.firstName,n.value.lastName=l==null?void 0:l.lastName,n.value.nationalCode=l==null?void 0:l.nationalCode,n.value.goldWeight=(o=l==null?void 0:l.wallet)==null?void 0:o.goldWeight,n.value.verificationStatus=l==null?void 0:l.verificationStatus,l}catch(l){l.response.status==401&&(localStorage.clear(),router.replace("/login")),N.value=l.response.data.error||"خطایی رخ داده است!",m.value=!0,setTimeout(()=>{m.value=!1},1e4)}finally{k.value=!1}},U=async()=>{var o,l,a,C,_;try{z.value=!0;const v=await B.inquiryGoldBoxReciever(r.value.reciever);return W.value=!0,i.value.firstName=(o=v.data)==null?void 0:o.firstName,i.value.lastName=(l=v.data)==null?void 0:l.lastName,i.value.nationalCode=(a=v.data)==null?void 0:a.nationalCode,i.value.goldWeight=(C=v.data)==null?void 0:C.goldWeight,i.value.goldBlock=(_=v.data)==null?void 0:_.goldBlock,v}catch(v){v.response.status==401&&(localStorage.clear(),router.replace("/login")),N.value=v.response.data.error||"خطایی رخ داده است!",m.value=!0,setTimeout(()=>{m.value=!1},1e4)}finally{z.value=!1}},q=async()=>{try{w.value=!0;const o=await B.confirmTransfer(r.value);return y.value=!1,D(),o}catch(o){o.response.status==401&&(localStorage.clear(),router.replace("/login")),N.value=o.response.data.error||"خطایی رخ داده است!",m.value=!0,setTimeout(()=>{m.value=!1},1e4)}finally{w.value=!1}},D=async()=>{x.value=!0,setInterval(()=>{x.value=!1,r.value.sender="",r.value.reciever="",r.value.goldWeight="",n.value.firstName="",n.value.lastName="",n.value.goldWeight="",n.value.nationalCode="",n.value.verificationStatus="",i.value.firstName="",i.value.lastName="",i.value.goldBlock="",i.value.goldWeight="",i.value.nationalCode="",i.value.phoneNumber=""},3e3)},E=()=>{j.every(o=>o(r.value.sender)===!0)},F=()=>{r.value.reciever=r.value.reciever.replace(/\D/g,"").slice(0,10),j.every(o=>o(r.value.reciever)===!0)},j=[o=>!!o||"کد ملی الزامی است",o=>/^\d{10}$/.test(o)||"کد ملی باید ۱۰ رقم باشد",o=>{if(!/^\d{10}$/.test(o))return!0;const l=+o[9],a=o.split("").slice(0,9).reduce((C,_,v)=>C+ +_*(10-v),0)%11;return a<2&&l===a||a>=2&&l+a===11||"کد ملی نامعتبر است"}],L=[o=>!!o||"کد ملی الزامی است"],M=()=>{r.value.goldWeight=r.value.goldWeight.replace(/[^0-9.]/g,"")},A=[o=>!!o||"مقدار ورودی نمی‌تواند خالی باشد"];return(o,l)=>($(),J(Q,null,[e(K,null,{default:t(()=>[e(c,null,{default:t(()=>[e(u,{cols:"12",class:"my-2"},{default:t(()=>[e(p,{class:"guide-section"},{default:t(()=>[e(b,null,{default:t(()=>l[9]||(l[9]=[s("h4",{class:"guideSection-title"},"راهنمای انتقال اضطراری",-1),s("ul",null,[s("li",null,"شخص انتقال دهنده، حتما باید جزو کاربران احراز نشده باشد."),s("li",null,"شخص انتقال گیرنده حتما باید جزو کاربران احراز شده باشد."),s("li",null,"مقدر انتقال باید برابر باشد با تمام موجودی شخص انتقال دهنده.")],-1)])),_:1})]),_:1})]),_:1}),e(u,{cols:"12",class:"my-2"},{default:t(()=>[e(p,null,{default:t(()=>[e(b,null,{default:t(()=>[l[16]||(l[16]=s("h3",{class:"mb-2"},"اطلاعات انتقال دهنده",-1)),e(c,null,{default:t(()=>[e(u,{cols:"12",md:"6"},{default:t(()=>[e(I,{modelValue:r.value.sender,"onUpdate:modelValue":l[0]||(l[0]=a=>r.value.sender=a),label:"کد ملی",variant:"outlined",rules:L,onInput:E},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",md:"6"},{default:t(()=>[e(V,{class:"py-2",color:"primary",size:"large",variant:"elevated",block:"",onClick:l[1]||(l[1]=a=>R()),loading:k.value},{default:t(()=>l[10]||(l[10]=[g(" استعلام انتقال دهنده ")])),_:1},8,["loading"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(u,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",Z,[l[11]||(l[11]=s("p",null,"نام : ",-1)),s("p",null,f((a=n.value)==null?void 0:a.firstName),1)])]}),_:1}),e(u,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",h,[l[12]||(l[12]=s("p",null,"نام خانوادگی : ",-1)),s("p",null,f((a=n.value)==null?void 0:a.lastName),1)])]}),_:1}),e(u,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",ll,[l[13]||(l[13]=s("p",null,"کد ملی : ",-1)),s("p",null,f((a=n.value)==null?void 0:a.nationalCode),1)])]}),_:1}),e(u,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",el,[l[14]||(l[14]=s("p",null,"موجودی صندوق طلا : ",-1)),s("p",null,f((a=n.value)==null?void 0:a.goldWeight)+" گرم",1)])]}),_:1}),e(u,{cols:"12",md:"4"},{default:t(()=>[s("div",al,[l[15]||(l[15]=s("p",{class:"mb-0"},"وضعیت : ",-1)),e(Y,{text:n.value.verificationStatus==1?"منتقل شده":n.value.verificationStatus==2?"منتقل نشده":"نامشخص",color:n.value.verificationStatus==1?"#00853f":n.value.verificationStatus==2?"#ff0000":"#66666",size:"small"},null,8,["text","color"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(u,{cols:"12"},{default:t(()=>[s("div",tl,[e(T,{icon:"ri-arrow-up-down-line",color:"#000"})])]),_:1}),e(u,{cols:"12",class:"my-2"},{default:t(()=>[e(p,null,{default:t(()=>[e(b,null,{default:t(()=>[l[23]||(l[23]=s("h3",{class:"mb-2"},"اطلاعات انتقال گیرنده",-1)),e(c,null,{default:t(()=>[e(u,{cols:"12",md:"6"},{default:t(()=>[e(I,{modelValue:r.value.reciever,"onUpdate:modelValue":l[2]||(l[2]=a=>r.value.reciever=a),label:"کد ملی",variant:"outlined",rules:j,onInput:F},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",md:"6"},{default:t(()=>[e(V,{class:"py-2",color:"primary",size:"large",variant:"elevated",block:"",onClick:l[3]||(l[3]=a=>U())},{default:t(()=>l[17]||(l[17]=[g(" استعلام انتقال گیرنده ")])),_:1})]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(u,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",sl,[l[18]||(l[18]=s("p",null,"نام : ",-1)),s("p",null,f((a=i.value)==null?void 0:a.firstName),1)])]}),_:1}),e(u,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",ol,[l[19]||(l[19]=s("p",null,"نام خانوادگی : ",-1)),s("p",null,f((a=i.value)==null?void 0:a.lastName),1)])]}),_:1}),e(u,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",ul,[l[20]||(l[20]=s("p",null,"کد ملی : ",-1)),s("p",null,f((a=i.value)==null?void 0:a.nationalCode),1)])]}),_:1}),e(u,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",rl,[l[21]||(l[21]=s("p",null,"طلای در انتظار : ",-1)),s("p",null,f((a=i.value)==null?void 0:a.goldBlock),1)])]}),_:1}),e(u,{cols:"12",md:"4"},{default:t(()=>{var a;return[s("div",nl,[l[22]||(l[22]=s("p",null,"موجودی صندوق طلا : ",-1)),s("p",null,f((a=i.value)==null?void 0:a.goldWeight)+" گرم",1)])]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(u,{cols:"12",class:"my-2"},{default:t(()=>[e(p,null,{default:t(()=>[e(b,null,{default:t(()=>[e(c,null,{default:t(()=>[e(u,{cols:"12",md:"6"},{default:t(()=>[e(I,{modelValue:r.value.goldWeight,"onUpdate:modelValue":l[4]||(l[4]=a=>r.value.goldWeight=a),label:"وزن (گرم)",variant:"outlined",rules:A,onInput:M,disabled:S.value!=!0||W.value!=!0},null,8,["modelValue","disabled"])]),_:1}),e(u,{cols:"12",md:"6"},{default:t(()=>[s("div",il,[e(V,{class:"py-2 px-10",color:"#c61a09",size:"large",variant:"elevated",disabled:S.value!=!0||W.value!=!0||r.value.goldWeight!=n.value.goldWeight,onClick:l[5]||(l[5]=a=>y.value=!0)},{default:t(()=>l[24]||(l[24]=[g(" تایید انتقال ")])),_:1},8,["disabled"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(G,{modelValue:y.value,"onUpdate:modelValue":l[7]||(l[7]=a=>y.value=a),"max-width":"500"},{default:t(()=>[e(p,{title:"تایید انتقال",class:"modal-card"},{default:t(()=>[e(T,{class:"mt-3 mb-6",icon:"ri-error-warning-fill",color:"#c61a09"}),l[27]||(l[27]=s("h4",{class:"my-3"}," آیا از این انتقال مطمئن هستید؟ ",-1)),l[28]||(l[28]=s("p",{class:"my-3"},"در صورت انجام این انتقال، امکان بازگشت وجود ندارد",-1)),s("div",dl,[e(V,{color:"#c61a09",size:"large",variant:"outlined",onClick:l[6]||(l[6]=a=>y.value=!1)},{default:t(()=>l[25]||(l[25]=[g(" لغو ")])),_:1}),e(V,{color:"#c61a09",size:"large",variant:"elevated",onClick:q,loading:w.value},{default:t(()=>l[26]||(l[26]=[g(" تایید ")])),_:1},8,["loading"])])]),_:1})]),_:1},8,["modelValue"]),e(G,{modelValue:x.value,"onUpdate:modelValue":l[8]||(l[8]=a=>x.value=a),"max-width":"500"},{default:t(()=>[e(p,{title:"تایید انتقال",class:"modal-card"},{default:t(()=>[e(T,{class:"mt-3 mb-6",icon:"ri-checkbox-circle-fill",color:"#0b8707"}),l[29]||(l[29]=s("h4",null," انتقال طلا با موفقیت انجام شد ",-1))]),_:1})]),_:1},8,["modelValue"]),m.value?($(),O(X,{key:0,color:"error",border:"bottom",elevation:"2",class:"k-alert alert-animatiton",closable:""},{default:t(()=>[g(f(N.value),1)]),_:1})):P("",!0)],64))}},wl=H(vl,[["__scopeId","data-v-7761353c"]]);export{wl as default};
