import{_ as G,r as u,c as H,a as e,b as t,w as s,a1 as p,e as m,h as g,F as J,o as c,a2 as o,a4 as k,C as V,t as r,bP as b}from"./index-Btd-pi8F.js";import{W}from"./wallet-_m08ywaq.js";import{V as K}from"./VDialog-snhuMTfV.js";import{V as j}from"./VAlert-BADi81bL.js";import{V as U}from"./VCard-wD3li9KV.js";import{V as S}from"./VTextField-B8DrViBe.js";import{V as X}from"./VOtpInput-7O5jvhwb.js";import{V as M}from"./VDivider-BGmw5LPC.js";import"./api-DSoKIxC4.js";import"./api-CqxMbhnv.js";import"./api-BmQ1t0xy.js";import"./dialog-transition-BEUyEo-d.js";import"./index-CavluHze.js";import"./index-B4ht9OuV.js";import"./createSimpleFunctional-CB_v5xJt.js";import"./VAvatar-90kupNrm.js";import"./VImg-B6gkO-4u.js";const Y={class:"d-flex align-center"},Z={class:"d-flex align-center"},h={class:"d-flex align-center"},ee={class:"d-flex align-center"},le={class:"d-flex align-center"},ae={class:"d-flex align-center"},te={class:"d-flex justify-center"},se={class:"d-flex justify-end"},oe={class:"transferModal-content py-5"},ne={class:"d-flex align-center"},re={class:"d-flex align-center"},de={class:"d-flex align-center"},ue={class:"d-flex align-center"},ie={class:"d-flex align-center"},ve={class:"d-flex align-center"},fe={class:"d-flex align-center"},ce={class:"d-flex align-center"},me={class:"d-flex align-center"},pe={class:"d-flex align-center"},ge={class:"d-flex align-center"},ye={class:"d-flex justify-space-around mt-2 mb-7"},_e={__name:"TransferView",setup(Ve){const y=u(""),f=u(!1),x=u(!1),O=u(!1),T=u(!1),D=u(!1),N=u(!1),L=u(""),w=u(!1),d=u({reciever:"",sender:"",goldWeight:""}),v=u({firstName:"",lastName:"",nationalCode:"",phoneNumber:"",goldWeight:"",goldBlock:""}),n=u({id:"",time:"",date:"",goldWeight:"",invoiceId:"",reciever:{firstName:"",lastName:"",nationalCode:""},sender:{firstName:"",lastName:"",nationalCode:"",goldWeight:""}}),I=u(),_=u(!1),B=u(!1),E=async()=>{try{B.value=!0;const a=await W.QuiryWallet(d.value.sender);return v.value.firstName=a.data.firstName,v.value.lastName=a.data.lastName,v.value.nationalCode=a.data.nationalCode,v.value.goldBlock=a.data.goldBlock,v.value.phoneNumber=a.data.phoneNumber,v.value.goldWeight=a.data.goldWeight,_.value=!0,a}catch(a){a.response.status==401&&(localStorage.clear(),b.replace("/login")),y.value=a.response.data.error||"خطایی رخ داده است!",f.value=!0,setTimeout(()=>{f.value=!1},1e4)}finally{B.value=!1}},F=async()=>{try{O.value=!0;const a=await W.CreateTransfer(d.value);return N.value=!0,n.value=a.data,n.value.id=a.data.id,n.value.invoiceId=a.data.invoiceId,n.value.date=a.data.date,n.value.time=a.data.time,n.value.sender.firstName=a.data.sender.firstName,n.value.sender.lastName=a.data.sender.lastName,n.value.sender.nationalCode=a.data.sender.nationalCode,n.value.sender.goldWeight=a.data.sender.wallet.goldWeight,n.value.reciever.firstName=a.data.reciever.firstName,n.value.reciever.lastName=a.data.reciever.lastName,n.value.reciever.nationalCode=a.data.reciever.nationalCode,a}catch(a){a.response.status==401&&(localStorage.clear(),b.replace("/Login")),y.value=a.response.data.msg||"خطایی رخ داده است!",f.value=!0,setTimeout(()=>{f.value=!1},5e3)}finally{O.value=!1}},R=async()=>{try{T.value=!0;const a=await W.TransferOtp(n.value.id);return N.value=!1,x.value=!0,a}catch(a){a.response.status==401&&(localStorage.clear(),b.replace("/Login")),y.value=a.response.data.msg||"خطایی رخ داده است!",f.value=!0,setTimeout(()=>{f.value=!1},5e3)}finally{T.value=!1}},q=async()=>{try{D.value=!0;const a=await W.VerifyTransferOtp(I.value,n.value.id);return x.value=!1,_.value=!1,d.value.sender=null,d.value.reciever=null,d.value.goldWeight=null,L.value=a.msg,w.value=!0,setTimeout(()=>{w.value=!1},5e3),a}catch(a){a.response.status==401&&(localStorage.clear(),b.replace("/Login")),y.value=a.response.data.msg||"خطایی رخ داده است!",f.value=!0,setTimeout(()=>{f.value=!1},5e3)}finally{D.value=!1}},C=[a=>!!a||"کد ملی الزامی است",a=>/^\d{10}$/.test(a)||"کد ملی باید ۱۰ رقم باشد",a=>{if(!/^\d{10}$/.test(a))return!0;const l=+a[9],i=a.split("").slice(0,9).reduce((A,P,Q)=>A+ +P*(10-Q),0)%11;return i<2&&l===i||i>=2&&l+i===11||"کد ملی نامعتبر است"}],$=()=>{d.value.sender=d.value.sender.replace(/\D/g,"").slice(0,10),C.every(a=>a(d.value.sender)===!0)},z=()=>{d.value.reciever=d.value.reciever.replace(/\D/g,"").slice(0,10),C.every(a=>a(d.value.reciever)===!0)};return(a,l)=>(c(),H(J,null,[e("div",null,[t(p,null,{default:s(()=>[t(o,{cols:"12"},{default:s(()=>[t(U,{title:"انتقال طلا",class:"transfer-card"},{default:s(()=>[t(p,null,{default:s(()=>[t(o,{class:"d-none d-md-flex",md:"2"}),t(o,{cols:"12",md:"4"},{default:s(()=>[t(S,{modelValue:d.value.sender,"onUpdate:modelValue":l[0]||(l[0]=i=>d.value.sender=i),label:"کد ملی انتقال دهنده",variant:"outlined",rules:C,onInput:$},null,8,["modelValue"])]),_:1}),t(o,{cols:"12",md:"4"},{default:s(()=>[t(k,{block:"",color:"#d4af37",size:"large",onClick:E,loading:B.value},{default:s(()=>l[5]||(l[5]=[V("استعلام موجودی")])),_:1},8,["loading"])]),_:1}),t(o,{class:"d-none d-md-flex",md:"2"})]),_:1}),_.value?(c(),m(p,{key:0},{default:s(()=>[t(o,{cols:"6",md:"3"},{default:s(()=>[e("div",Y,[l[6]||(l[6]=e("p",null,"نام : ",-1)),e("p",null,r(v.value.firstName),1)])]),_:1}),t(o,{cols:"6",md:"3"},{default:s(()=>[e("div",Z,[l[7]||(l[7]=e("p",null,"نام خانوادگی : ",-1)),e("p",null,r(v.value.lastName),1)])]),_:1}),t(o,{cols:"6",md:"3"},{default:s(()=>[e("div",h,[l[8]||(l[8]=e("p",null,"شماره همراه : ",-1)),e("p",null,r(v.value.phoneNumber),1)])]),_:1}),t(o,{cols:"6",md:"3"},{default:s(()=>[e("div",ee,[l[9]||(l[9]=e("p",null,"کد ملی : ",-1)),e("p",null,r(v.value.nationalCode),1)])]),_:1}),t(o,{cols:"6",md:"3"},{default:s(()=>[e("div",le,[l[10]||(l[10]=e("p",null,"موجودی طلا : ",-1)),e("p",null,r(v.value.goldWeight),1)])]),_:1}),t(o,{cols:"6",md:"3"},{default:s(()=>[e("div",ae,[l[11]||(l[11]=e("p",null,"در صف انتقال : ",-1)),e("p",null,r(v.value.goldBlock),1)])]),_:1})]),_:1})):g("",!0),_.value?(c(),m(p,{key:1},{default:s(()=>[t(o,{class:"d-none d-md-flex",md:"2"}),t(o,{cols:"12",md:"4"},{default:s(()=>[t(S,{modelValue:d.value.reciever,"onUpdate:modelValue":l[1]||(l[1]=i=>d.value.reciever=i),label:"کد ملی گیرنده",variant:"outlined",rules:C,onInput:z},null,8,["modelValue"])]),_:1}),t(o,{cols:"12",md:"4"},{default:s(()=>[t(S,{modelValue:d.value.goldWeight,"onUpdate:modelValue":l[2]||(l[2]=i=>d.value.goldWeight=i),label:"وزن طلا",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(o,{class:"d-none d-md-flex",md:"2"})]),_:1})):g("",!0),t(p,null,{default:s(()=>[t(o,{md:"4",class:"d-none d-md-flex"}),x.value?(c(),m(o,{key:0,cols:"12",md:"4"},{default:s(()=>[e("div",te,[t(X,{length:4,modelValue:I.value,"onUpdate:modelValue":l[3]||(l[3]=i=>I.value=i),type:"number",variant:"outlined",class:"otp-input"},null,8,["modelValue"])])]),_:1})):g("",!0),t(o,{md:"4",class:"d-none d-md-flex"})]),_:1}),_.value?(c(),m(p,{key:2},{default:s(()=>[t(o,{cols:"12"},{default:s(()=>[e("div",se,[x.value?(c(),m(k,{key:1,color:"#d4af37",onClick:q},{default:s(()=>l[13]||(l[13]=[V("تایید نهایی")])),_:1})):(c(),m(k,{key:0,color:"#d4af37",onClick:F},{default:s(()=>l[12]||(l[12]=[V("ثبت انتقال")])),_:1}))])]),_:1})]),_:1})):g("",!0)]),_:1})]),_:1})]),_:1})]),t(K,{"max-width":"500",modelValue:N.value,"onUpdate:modelValue":l[4]||(l[4]=i=>N.value=i)},{default:s(()=>[t(U,{class:"trade-modal"},{default:s(()=>[e("div",oe,[l[27]||(l[27]=e("h3",{class:"my-4"},"فاکتور انتقال",-1)),t(p,null,{default:s(()=>[t(o,{cols:"6",class:"my-1 pa-1"},{default:s(()=>[e("div",ne,[l[14]||(l[14]=e("p",null,"گرم انتقال :",-1)),e("p",null,r(n.value.goldWeight),1)])]),_:1}),t(o,{cols:"6",class:"my-1 pa-1"},{default:s(()=>[e("div",re,[l[15]||(l[15]=e("p",null,"شماره فاکتور :",-1)),e("p",null,r(n.value.invoiceId),1)])]),_:1}),t(o,{cols:"6",class:"my-1 pa-1"},{default:s(()=>[e("div",de,[l[16]||(l[16]=e("p",null,"تاریخ انتقال :",-1)),e("p",null,r(n.value.date),1)])]),_:1}),t(o,{cols:"6",class:"my-1 pa-1"},{default:s(()=>[e("div",ue,[l[17]||(l[17]=e("p",null,"زمان انتقال :",-1)),e("p",null,r(n.value.time),1)])]),_:1}),t(M),t(o,{cols:"12"},{default:s(()=>l[18]||(l[18]=[e("div",{class:"d-flex justify-start"},[e("p",{class:"font-weight-bold"},"اطلاعات انتقال دهنده")],-1)])),_:1}),t(o,{cols:"6",class:"my-1 pa-1"},{default:s(()=>[e("div",ie,[l[19]||(l[19]=e("p",null,"نام :",-1)),e("p",null,r(n.value.sender.firstName),1)])]),_:1}),t(o,{cols:"6",class:"my-1 pa-1"},{default:s(()=>[e("div",ve,[l[20]||(l[20]=e("p",null,"نام خانوادگی :",-1)),e("p",null,r(n.value.sender.lastName),1)])]),_:1}),t(o,{cols:"6",class:"my-1 pa-1"},{default:s(()=>[e("div",fe,[l[21]||(l[21]=e("p",null,"کد ملی :",-1)),e("p",null,r(n.value.sender.nationalCode),1)])]),_:1}),t(o,{cols:"6",class:"my-1 pa-1"},{default:s(()=>[e("div",ce,[l[22]||(l[22]=e("p",null,"موجودی :",-1)),e("p",null,r(n.value.sender.goldWeight)+" گرم",1)])]),_:1}),t(M),t(o,{cols:"12"},{default:s(()=>l[23]||(l[23]=[e("div",{class:"d-flex justify-start"},[e("p",{class:"font-weight-bold"},"اطلاعات گیرنده")],-1)])),_:1}),t(o,{cols:"6",class:"my-1 pa-1"},{default:s(()=>[e("div",me,[l[24]||(l[24]=e("p",null,"نام :",-1)),e("p",null,r(n.value.reciever.firstName),1)])]),_:1}),t(o,{cols:"6",class:"my-1 pa-1"},{default:s(()=>[e("div",pe,[l[25]||(l[25]=e("p",null,"نام خانوادگی :",-1)),e("p",null,r(n.value.reciever.lastName),1)])]),_:1}),t(o,{cols:"6",class:"my-1 pa-1"},{default:s(()=>[e("div",ge,[l[26]||(l[26]=e("p",null,"کد ملی :",-1)),e("p",null,r(n.value.reciever.nationalCode),1)])]),_:1})]),_:1})]),e("div",ye,[t(k,{text:"تایید انتقال",class:"pay-btn",color:"#9D7E3B",block:"",loading:T.value,onClick:R},null,8,["loading"])])]),_:1})]),_:1},8,["modelValue"]),f.value?(c(),m(j,{key:0,color:"error",border:"bottom",elevation:"2",class:"k-alert alert-animatiton",closable:""},{default:s(()=>[V(r(y.value),1)]),_:1})):g("",!0),w.value?(c(),m(j,{key:1,color:"success",border:"bottom",elevation:"2",class:"k-alert alert-animatiton",closable:""},{default:s(()=>[V(r(L.value),1)]),_:1})):g("",!0)],64))}},Ee=G(_e,[["__scopeId","data-v-0a2051e0"]]);export{Ee as default};
